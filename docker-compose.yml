# =============================================================================
# Autonomous Research Agent - Docker Compose Configuration
# =============================================================================
#
# Usage:
#   Start:    docker-compose up -d
#   Stop:     docker-compose down
#   Logs:     docker-compose logs -f
#   Rebuild:  docker-compose up -d --build
#
# =============================================================================

version: '3.8'

services:
  research-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: research-agent
    restart: unless-stopped

    ports:
      - "8501:8501"

    environment:
      # API Keys - Set these in .env file or pass directly
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - TAVILY_API_KEY=${TAVILY_API_KEY}

      # Streamlit Configuration
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

    volumes:
      # Persist research sessions
      - ./research_sessions:/app/research_sessions

      # Optional: Mount .env file
      - ./.env:/app/.env:ro

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# Optional: Named volumes for data persistence
volumes:
  research_data:
    driver: local
